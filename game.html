<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚²ãƒ¼ãƒ  | èˆé¶´é«˜å°‚ ã‚‚ã®ã¤ãã‚Šãƒ©ãƒœ</title>
  <link rel="icon" type="image/png" href="images/logo.png" />
  <link rel="stylesheet" href="css/style.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ã‚²ãƒ¼ãƒ å›ºæœ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    :root {
      --game-bg: #0f1220;
      --game-panel: #171a2b;
      --game-text: #e8ebff;
      --game-accent: #7aa2ff;
      --game-danger: #ff6b6b;
      --game-muted: #9aa3b2;
    }
    .game-card {
      background: linear-gradient(180deg, #151a2d, var(--game-panel));
      border: 1px solid #22273d;
      box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
    }
    .game-header {
      display: flex; gap: 12px; align-items: center; justify-content: space-between;
      padding: 14px 16px; border-bottom: 1px solid #22273d; background: #13182b99;
    }
    .game-header h2 { font-size: 16px; margin: 0; font-weight: 700; letter-spacing: .02em; color: var(--game-text); }
    .stats { display: flex; gap: 12px; align-items: center; font-variant-numeric: tabular-nums; }
    .chip { padding: 6px 10px; border-radius: 999px; background: #0f1530; border: 1px solid #2a335c; color: var(--game-text); font-size: 14px; }

    .stage-wrap { position: relative; aspect-ratio: 16/9; width: 100%; background: #0a0f24; }
    canvas { width: 100%; height: 100%; display: block; }

    .game-controls { display: flex; flex-wrap: wrap; gap: 8px; padding: 12px 16px; border-top: 1px solid #22273d; background: #101427; }
    .game-btn {
      appearance: none; border: 1px solid #2a335c; background: #121833; color: var(--game-text);
      padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 700; letter-spacing: .02em;
      transition: transform .06s ease, background .2s ease, border-color .2s ease; user-select: none;
    }
    .game-btn:hover { background: #17214a; }
    .game-btn:active { transform: translateY(1px); }
    .btn-accent { border-color: #3253ff; background: #1a2466; }
    .btn-danger { border-color: #ff6b6b55; background: #3a121f; }

    .overlay { position: absolute; inset: 0; display: grid; place-items: center; background: rgba(12,16,34,.55); backdrop-filter: blur(2px); }
    .panel { background: #0f1430; border: 1px solid #243062; padding: 20px; border-radius: 14px; text-align: center; max-width: 520px; color: var(--game-text); }
    .panel h3 { margin: 0 0 8px; }
    .panel p { margin: 0 0 14px; color: var(--game-muted); }

    /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ç°¡æ˜“D-Pad */
    .dpad { position: absolute; left: 10px; bottom: 10px; display: grid; grid-template-columns: repeat(3, 52px); grid-template-rows: repeat(3, 52px); gap: 6px; opacity: .7; }
    .dpad button { border-radius: 12px; background: #0e1433; border: 1px solid #2c3770; color: var(--game-text); cursor: pointer; }
    .dpad button:active { background: #122066; }
    .hidden { display: none; }
    @media (hover:none) and (pointer:coarse) { .dpad { opacity: .9; } }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
<header class="bg-white shadow-md fixed top-0 w-full z-50">
  <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
    <h1 class="text-lg sm:text-xl font-bold whitespace-nowrap overflow-hidden text-ellipsis">èˆé¶´é«˜å°‚ ã‚‚ã®ã¤ãã‚Šãƒ©ãƒœ</h1>
    <!-- ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ (ãƒ¢ãƒã‚¤ãƒ«) -->
    <button id="menu-toggle" class="md:hidden flex flex-col gap-1 p-2" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
      <span class="w-6 h-0.5 bg-gray-800 transition-all"></span>
      <span class="w-6 h-0.5 bg-gray-800 transition-all"></span>
      <span class="w-6 h-0.5 bg-gray-800 transition-all"></span>
    </button>
    <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <nav class="hidden md:flex space-x-4">
      <a href="index.html" class="hover:text-blue-500">ãƒ›ãƒ¼ãƒ </a>
      <a href="activities.html" class="hover:text-blue-500">æ´»å‹•</a>
      <a href="facility.html" class="hover:text-blue-500">æ–½è¨­</a>
      <a href="members.html" class="hover:text-blue-500">ã‚¹ã‚¿ãƒƒãƒ•</a>
      <a href="contact.html" class="hover:text-blue-500">ãŠå•ã„åˆã‚ã›</a>
      <a href="game.html" class="hover:text-blue-500">ã‚²ãƒ¼ãƒ </a>
    </nav>
  </div>
  <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <nav id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
    <div class="px-4 py-2 space-y-2">
      <a href="index.html" class="block py-2 hover:text-blue-500">ãƒ›ãƒ¼ãƒ </a>
      <a href="activities.html" class="block py-2 hover:text-blue-500">æ´»å‹•</a>
      <a href="facility.html" class="block py-2 hover:text-blue-500">æ–½è¨­</a>
      <a href="members.html" class="block py-2 hover:text-blue-500">ã‚¹ã‚¿ãƒƒãƒ•</a>
      <a href="contact.html" class="block py-2 hover:text-blue-500">ãŠå•ã„åˆã‚ã›</a>
      <a href="game.html" class="block py-2 hover:text-blue-500">ã‚²ãƒ¼ãƒ </a>
    </div>
  </nav>
</header>

<main class="pt-24 px-4 pb-16">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-3xl font-bold mb-6 text-center">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ  - Dodger</h1>
    
    <div id="app" class="game-card rounded-2xl overflow-hidden shadow-lg">
      <div class="game-header">
        <h2>Dodger â€” Vue3 Ã— Canvas</h2>
        <div class="stats">
          <span class="chip">Score: {{ score }}</span>
          <span class="chip">Best: {{ highScore }}</span>
          <span class="chip">Speed: x{{ speed.toFixed(2) }}</span>
        </div>
      </div>

      <div class="stage-wrap">
        <canvas ref="canvas" @pointerdown="onPointerStart" @pointermove="onPointerMove" @pointerup="onPointerEnd" @pointercancel="onPointerEnd"></canvas>

        <!-- é–‹å§‹ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <div v-if="!started && !gameOver" class="overlay">
          <div class="panel">
            <h3 class="text-xl font-bold">çŸ¢å°ã‚­ãƒ¼ / WASDã§ç§»å‹•</h3>
            <p>è½ã¡ã¦ãã‚‹éšœå®³ç‰©ã‚’é¿ã‘ã‚ˆã†ã€‚æ™‚é–“ãŒçµŒã¤ã»ã©é›£ã—ããªã‚Šã¾ã™ã€‚</p>
            <button class="game-btn btn-accent" @click="start()">â–¶ ã¯ã˜ã‚ã‚‹</button>
          </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
        <div v-if="gameOver" class="overlay">
          <div class="panel">
            <h3 class="text-xl font-bold">Game Over ğŸ˜µ</h3>
            <p>Score: {{ score }} ï¼ Best: {{ highScore }}</p>
            <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
              <button class="game-btn btn-accent" @click="restart()">â†» ã‚‚ã†ä¸€åº¦</button>
              <button class="game-btn" @click="share()">Share</button>
            </div>
          </div>
        </div>

        <!-- ãƒ¢ãƒã‚¤ãƒ«D-Pad -->
      <div class="dpad" :class="{ hidden: hideDpad }">
        <span></span>
        <button @pointerdown.prevent="press('up', true)" @pointerup="press('up', false)">â–²</button>
        <span></span>
        <button @pointerdown.prevent="press('left', true)" @pointerup="press('left', false)">â—€</button>
        <span></span>
        <button @pointerdown.prevent="press('right', true)" @pointerup="press('right', false)">â–¶</button>
        <span></span>
        <button @pointerdown.prevent="press('down', true)" @pointerup="press('down', false)">â–¼</button>
        <span></span>
      </div>
    </div>

    <div class="game-controls">
      <button class="game-btn" @click="togglePause" :class="{ 'btn-accent': paused }">{{ paused ? 'â–¶ å†é–‹' : 'â¸ ä¸€æ™‚åœæ­¢' }}</button>
      <button class="game-btn btn-danger" @click="restart">â†» ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ</button>
      <button class="game-btn" @click="hideDpad = !hideDpad">D-Pad {{ hideDpad ? 'è¡¨ç¤º' : 'éè¡¨ç¤º' }}</button>
    </div>
  </div>

  <div class="mt-8 bg-white rounded-xl shadow p-6 max-w-5xl mx-auto">
    <h2 class="text-xl font-bold mb-4 text-blue-700">éŠã³æ–¹</h2>
    <ul class="list-disc list-inside space-y-2 text-gray-700">
      <li><strong>æ“ä½œæ–¹æ³•ï¼š</strong>çŸ¢å°ã‚­ãƒ¼ ã¾ãŸã¯ WASDã‚­ãƒ¼ ã§ç§»å‹•</li>
      <li><strong>ãƒ«ãƒ¼ãƒ«ï¼š</strong>ä¸Šã‹ã‚‰è½ã¡ã¦ãã‚‹èµ¤ã„éšœå®³ç‰©ã‚’é¿ã‘ç¶šã‘ã‚ˆã†</li>
      <li><strong>é›£æ˜“åº¦ï¼š</strong>æ™‚é–“ãŒçµŒã¤ã»ã©ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé€Ÿããªã‚Šã¾ã™</li>
      <li><strong>ã‚¹ãƒãƒ›ï¼š</strong>ç”»é¢å·¦ä¸‹ã®D-Padã¾ãŸã¯ã‚¹ãƒ¯ã‚¤ãƒ—ã§æ“ä½œã§ãã¾ã™</li>
      <li><strong>ä¸€æ™‚åœæ­¢ï¼š</strong>ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼ã¾ãŸã¯ãƒœã‚¿ãƒ³ã§ä¸€æ™‚åœæ­¢</li>
    </ul>
  </div>
</main>

<footer class="bg-gray-800 text-white text-center py-4 mt-10">
  <p>&copy; 2025 èˆé¶´é«˜å°‚ ã‚‚ã®ã¤ãã‚Šãƒ©ãƒœ</p>
</footer>

<script>
// ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¶å¾¡
const menuToggle = document.getElementById('menu-toggle');
const mobileMenu = document.getElementById('mobile-menu');

if (menuToggle && mobileMenu) {
  menuToggle.addEventListener('click', function() {
    mobileMenu.classList.toggle('hidden');
  });
}
</script>

  <!-- Vue 3 CDNï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ“ãƒ«ãƒ‰ï¼‰ -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script>
    const { createApp, ref, reactive, onMounted, onUnmounted } = Vue;

    createApp({
      setup() {
        const canvas = ref(null);
        const ctxRef = ref(null);
        const started = ref(false);
        const paused = ref(false);
        const gameOver = ref(false);
        const score = ref(0);
        const highScore = ref(Number(localStorage.getItem('dodger:best') || 0));
        const speed = ref(1);
        const hideDpad = ref(false);

        const W = ref(0), H = ref(0);

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ & éšœå®³ç‰©
        const player = reactive({ x: 0, y: 0, w: 26, h: 26, speed: 280 });
        const keys = reactive({ up:false, down:false, left:false, right:false });
        const pointer = reactive({ active: false, id: null, startX:0, startY:0, x:0, y:0 });
        const obstacles = reactive([]); // {x,y,w,h,vy}

        // æ™‚é–“ç®¡ç†
        let last = 0; // æœ€å¾Œã®ãƒ•ãƒ¬ãƒ¼ãƒ ã®timestamp
        let rafId = null;
        let spawnTimer = 0;

        function resize() {
          const el = canvas.value;
          const rect = el.parentElement.getBoundingClientRect();
          // å®Ÿãƒ”ã‚¯ã‚»ãƒ«ã«åˆã‚ã›ã‚‹ï¼ˆé«˜è§£åƒåº¦å¯¾å¿œï¼‰
          const dpr = Math.min(window.devicePixelRatio || 1, 2);
          const targetW = Math.floor(rect.width);
          const targetH = Math.floor(rect.height);
          W.value = targetW; H.value = targetH;
          el.width = Math.floor(targetW * dpr);
          el.height = Math.floor(targetH * dpr);
          el.getContext('2d').setTransform(dpr, 0, 0, dpr, 0, 0);
        }

        function reset() {
          score.value = 0; speed.value = 1; gameOver.value = false; paused.value = false; started.value = false;
          obstacles.splice(0, obstacles.length);
          spawnTimer = 0; last = 0;
          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆæœŸä½ç½®
          player.x = W.value * 0.5 - player.w * 0.5;
          player.y = H.value - player.h - 18;
        }

        function start() {
          started.value = true; paused.value = false; gameOver.value = false;
          if (!rafId) { last = performance.now(); rafId = requestAnimationFrame(loop); }
        }

        function restart() {
          reset();
          started.value = true; // ã™ãå†é–‹
          if (!rafId) { last = performance.now(); rafId = requestAnimationFrame(loop); }
        }

        function togglePause() {
          if (!started.value || gameOver.value) return;
          paused.value = !paused.value;
          if (!paused.value && !rafId) { last = performance.now(); rafId = requestAnimationFrame(loop); }
        }

        function share() {
          const text = `Dodgerã§ ${score.value} ç‚¹ï¼å›ã¯è¶…ãˆã‚‰ã‚Œã‚‹ï¼Ÿ`;
          const url = location.href;
          if (navigator.share) navigator.share({ title: 'Dodger', text, url });
          else alert(text + "\n" + url);
        }

        // å…¥åŠ›å‡¦ç†
        function onKey(e, down) {
          const k = e.key.toLowerCase();
          if (['arrowup','w'].includes(k)) keys.up = down;
          if (['arrowdown','s'].includes(k)) keys.down = down;
          if (['arrowleft','a'].includes(k)) keys.left = down;
          if (['arrowright','d'].includes(k)) keys.right = down;
          if (k === ' ' && down) togglePause();
        }

        function press(dir, down) {
          keys[dir] = down;
        }

        function onPointerStart(e) {
          pointer.active = true; pointer.id = e.pointerId; pointer.startX = e.clientX; pointer.startY = e.clientY; pointer.x = e.clientX; pointer.y = e.clientY;
        }
        function onPointerMove(e) {
          if (!pointer.active || pointer.id !== e.pointerId) return;
          const dx = e.clientX - pointer.startX;
          const dy = e.clientY - pointer.startY;
          keys.left = dx < -8; keys.right = dx > 8; keys.up = dy < -8; keys.down = dy > 8;
          pointer.x = e.clientX; pointer.y = e.clientY;
        }
        function onPointerEnd() {
          pointer.active = false; pointer.id = null; keys.up = keys.down = keys.left = keys.right = false;
        }

        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function loop(ts) {
          rafId = null;
          const dt = Math.min(0.033, (ts - last) / 1000 || 0);
          last = ts;
          if (!paused.value && started.value && !gameOver.value) {
            update(dt);
            draw();
          }
          if (!paused.value && started.value && !gameOver.value) rafId = requestAnimationFrame(loop);
        }

        function update(dt) {
          // é›£æ˜“åº¦ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆæ™‚é–“ã§ä¸Šæ˜‡/ä¸Šé™2.5ï¼‰
          speed.value = Math.min(2.5, speed.value + dt * 0.05);
          score.value += Math.floor(dt * 60);

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç§»å‹•
          let vx = 0, vy = 0;
          if (keys.left) vx -= 1; if (keys.right) vx += 1; if (keys.up) vy -= 1; if (keys.down) vy += 1;
          if (vx && vy) { vx *= Math.SQRT1_2; vy *= Math.SQRT1_2; }
          player.x += vx * player.speed * dt;
          player.y += vy * player.speed * dt;
          player.x = Math.max(0, Math.min(W.value - player.w, player.x));
          player.y = Math.max(0, Math.min(H.value - player.h, player.y));

          // éšœå®³ç‰©ç”Ÿæˆ
          spawnTimer -= dt;
          if (spawnTimer <= 0) {
            spawnTimer = Math.max(0.25, 0.9 - speed.value * 0.22);
            const count = 1 + (Math.random() < Math.min(0.6, (speed.value-1)*0.5) ? 1 : 0);
            for (let i=0;i<count;i++) {
              const w = 20 + Math.random()*40;
              const h = 10 + Math.random()*28;
              obstacles.push({ x: Math.random()*(W.value - w), y: -h, w, h, vy: (120 + Math.random()*140) * speed.value });
            }
          }

          // éšœå®³ç‰©æ›´æ–° & è¡çª
          for (let i=obstacles.length-1;i>=0;i--) {
            const o = obstacles[i];
            o.y += o.vy * dt;
            if (rectsOverlap(player, o)) {
              gameOver.value = true;
              highScore.value = Math.max(highScore.value, score.value);
              localStorage.setItem('dodger:best', String(highScore.value));
              break;
            }
            if (o.y > H.value + 50) obstacles.splice(i,1);
          }
        }

        function rectsOverlap(a,b){
          return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
        }

        function draw() {
          const ctx = ctxRef.value; if (!ctx) return;
          ctx.clearRect(0,0,W.value,H.value);
          // èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰
          ctx.globalAlpha = 0.6; ctx.fillStyle = '#0b0f27'; ctx.fillRect(0,0,W.value,H.value); ctx.globalAlpha = 1;
          drawGrid(ctx);
          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
          ctx.fillStyle = '#7aa2ff';
          roundRect(ctx, player.x, player.y, player.w, player.h, 5, true);
          // éšœå®³ç‰©
          ctx.fillStyle = '#ff6b6b';
          for (const o of obstacles) roundRect(ctx, o.x, o.y, o.w, o.h, 4, true);
        }

        function drawGrid(ctx) {
          ctx.save();
          ctx.strokeStyle = '#1b2346'; ctx.lineWidth = 1;
          const step = 32;
          for (let x=0; x<W.value; x+=step) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H.value); ctx.stroke(); }
          for (let y=0; y<H.value; y+=step) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W.value,y); ctx.stroke(); }
          ctx.restore();
        }

        function roundRect(ctx, x, y, w, h, r, fill=true) {
          ctx.beginPath();
          ctx.moveTo(x+r, y);
          ctx.arcTo(x+w, y, x+w, y+h, r);
          ctx.arcTo(x+w, y+h, x, y+h, r);
          ctx.arcTo(x, y+h, x, y, r);
          ctx.arcTo(x, y, x+w, y, r);
          if (fill) ctx.fill(); else ctx.stroke();
        }

        onMounted(() => {
          resize();
          const el = canvas.value;
          ctxRef.value = el.getContext('2d');
          reset();
          window.addEventListener('resize', resize);
          window.addEventListener('keydown', e => onKey(e, true));
          window.addEventListener('keyup', e => onKey(e, false));
        });

        onUnmounted(() => {
          cancelAnimationFrame(rafId);
          window.removeEventListener('resize', resize);
        });

        return {
          canvas, started, paused, gameOver, score, highScore, speed, hideDpad,
          start, restart, togglePause, share, onPointerStart, onPointerMove, onPointerEnd, press
        };
      }
    }).mount('#app');
  </script>
</body>
</html>
